<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SBrandsborg Minecraft ATM 10 Server - Statistics</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #2c2f33;
            color: #fff;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: row;
            justify-content: center;
        }
        .container {
            max-width: 700px;
            padding: 20px;
            background: #3e3e3e;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            text-align: center;
        }
        .stats-summary {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
        }
        .stats-summary th, .stats-summary td {
            border: 1px solid #fff;
            padding: 10px;
        }
        .chart-container {
            margin-top: 20px;
        }
        .players-container {
            margin-left: 20px;
            padding: 20px;
            background: #23272a;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            width: 250px;
        }
        .summary-text {
            margin-top: 20px;
            font-size: 18px;
        }
        a {
            color: #f1c40f;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="header">‚õèÔ∏è SBrandsborg Minecraft ATM 10 Server - Statistics ‚õèÔ∏è</h1>
        <p>üîÑ Updated every 15 minutes</p>
        <p><a href="https://sbrandsborg.github.io/MinecraftServer/">üè† Return to Main Page</a></p>
        
        <h2>üåç Server Overview</h2>
        <p>The server has been running for <strong><span id="days"></span></strong> days, and the in-game time is currently <strong><span id="time"></span></strong>. Right now, it's <span id="dayNight"></span>.</p>
        
        <h2>üìä Server Summary</h2>
        <p class="summary-text" id="summaryText"></p>
        
        <table class="stats-summary">
            <tr>
                <th>Chests Looted</th>
                <th>Items Inserted (ME Network)</th>
                <th>Mob Kills</th>
                <th>Times Jumped</th>
                <th>Deaths</th>
                <th>Time Played (Minutes)</th>
            </tr>
            <tr>
                <td id="totalChestsLooted">0</td>
                <td id="totalItemsInserted">0</td>
                <td id="totalMobKills">0</td>
                <td id="totalTimesJumped">0</td>
                <td id="totalDeaths">0</td>
                <td id="totalTimePlayed">0</td>
            </tr>
        </table>
        
        <h2>üìà Player Statistics</h2>
        <div class="chart-container">
            <canvas id="chestsChart"></canvas>
            <canvas id="itemsChart"></canvas>
            <canvas id="mobsChart"></canvas>
            <canvas id="jumpsChart"></canvas>
            <canvas id="deathsChart"></canvas>
            <canvas id="timePlayedChart"></canvas>
        </div>
    </div>
    
    <div class="players-container">
        <p><strong>üü¢ Online Players:</strong></p>
        <ul id="onlinePlayers"></ul>
        <p><strong>üî¥ Offline Players:</strong></p>
        <ul id="offlinePlayers"></ul>
    </div>

    <script>
        async function fetchStats() {
            try {
                const response = await fetch('Get-MCStats.json');
                const data = await response.json();
                
                document.getElementById('time').textContent = data.currentInGameTime;
                document.getElementById('days').textContent = data.inGameDays;
                
                const timeParts = data.currentInGameTime.split(':');
                const hours = parseInt(timeParts[0]);
                document.getElementById('dayNight').textContent = hours >= 6 && hours < 18 ? "‚òÄÔ∏è Daytime in the Overworld" : "üåô Nighttime in the Overworld";
                
                let totalChestsLooted = 0, totalItemsInserted = 0, totalMobKills = 0, totalTimesJumped = 0, totalDeaths = 0, totalTimePlayed = 0;
                
                data.playerStats.forEach(player => {
                    const stats = player.stats["minecraft:custom"] || {};
                    totalChestsLooted += stats["minecraft:open_chest"] || 0;
                    totalItemsInserted += stats["minecraft:items_inserted"] || 0;
                    totalMobKills += stats["minecraft:mob_kills"] || 0;
                    totalTimesJumped += stats["minecraft:jump"] || 0;
                    totalDeaths += stats["minecraft:deaths"] || 0;
                    totalTimePlayed += stats["minecraft:play_one_minute"] || 0;
                });
                
                document.getElementById('totalChestsLooted').textContent = totalChestsLooted;
                document.getElementById('totalItemsInserted').textContent = totalItemsInserted;
                document.getElementById('totalMobKills').textContent = totalMobKills;
                document.getElementById('totalTimesJumped').textContent = totalTimesJumped;
                document.getElementById('totalDeaths').textContent = totalDeaths;
                document.getElementById('totalTimePlayed').textContent = Math.floor(totalTimePlayed / 20); // Convert ticks to minutes
                
                document.getElementById('summaryText').textContent = `The players have been busy! They have looted ${totalChestsLooted} chests, inserted ${totalItemsInserted} items into the ME network, and slain ${totalMobKills} mobs. They've jumped ${totalTimesJumped} times, died ${totalDeaths} times, and played for a total of ${Math.floor(totalTimePlayed / 20)} minutes!`;
            } catch (error) {
                console.error('Error fetching stats:', error);
            }
        }

        fetchStats();
        setInterval(fetchStats, 900000);
    </script>
</body>
</html>
