<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SBrandsborg Minecraft ATM 10 Server - Statistics</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #2c2f33; /* Neutral Discord-like background */
            color: #fff;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: row;
            justify-content: center;
        }
        .container {
            max-width: 700px;
            padding: 20px;
            background: #3e3e3e;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            text-align: center;
        }
        .stats-summary {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
        }
        .stats-summary th, .stats-summary td {
            border: 1px solid #fff;
            padding: 10px;
        }
        .chart-container {
            margin-top: 20px;
        }
        .players-container {
            margin-left: 20px;
            padding: 20px;
            background: #23272a;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            width: 250px;
        }
        a {
            color: #f1c40f;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="header">⛏️ SBrandsborg Minecraft ATM 10 Server - Statistics ⛏️</h1>
        <p>🔄 Updated every 15 minutes</p>
        <p><a href="https://sbrandsborg.github.io/MinecraftServer/">🏠 Return to Main Page</a></p>
        <p><strong>⏳ In-Game Time:</strong> <span id="time"></span></p>
        <p><strong>📅 Days Passed:</strong> <span id="days"></span></p>
        <p class="day-night" id="dayNight"></p>
        
        <h2>📊 Server Summary</h2>
        <table class="stats-summary">
            <tr>
                <th>Chests Looted</th>
                <th>Items Inserted (ME Network)</th>
                <th>Mob Kills</th>
            </tr>
            <tr>
                <td id="totalChestsLooted">0</td>
                <td id="totalItemsInserted">0</td>
                <td id="totalMobKills">0</td>
            </tr>
        </table>
        
        <div class="chart-container">
            <canvas id="chestsChart"></canvas>
            <canvas id="itemsChart"></canvas>
            <canvas id="mobsChart"></canvas>
        </div>
    </div>
    
    <div class="players-container">
        <p><strong>🟢 Online Players:</strong></p>
        <ul id="onlinePlayers"></ul>
        <p><strong>🔴 Offline Players:</strong></p>
        <ul id="offlinePlayers"></ul>
    </div>

    <script>
        async function fetchStats() {
            try {
                const response = await fetch('Get-MCStats.json');
                const data = await response.json();
                
                document.getElementById('time').textContent = data.currentInGameTime;
                document.getElementById('days').textContent = data.inGameDays;
                
                const timeParts = data.currentInGameTime.split(':');
                const hours = parseInt(timeParts[0]);
                document.getElementById('dayNight').textContent = hours >= 6 && hours < 18 ? "☀️ Daytime in the Overworld" : "🌙 Nighttime in the Overworld";
                
                const allPlayers = data.playerStats.map(player => player.playerName);
                const onlinePlayers = data.onlinePlayers;
                
                document.getElementById('onlinePlayers').innerHTML = onlinePlayers.map(player => `<li class='online'>${player}</li>`).join('');
                document.getElementById('offlinePlayers').innerHTML = allPlayers.filter(player => !onlinePlayers.includes(player)).map(player => `<li class='offline'>${player}</li>`).join('');
                
                let totalChestsLooted = 0, totalItemsInserted = 0, totalMobKills = 0;
                let playerStats = {};
                
                data.playerStats.forEach(player => {
                    const stats = player.stats["minecraft:custom"] || {};
                    const chestsLooted = stats["minecraft:open_chest"] || 0;
                    const itemsInserted = stats["minecraft:items_inserted"] || 0;
                    const mobKills = stats["minecraft:mob_kills"] || 0;
                    
                    totalChestsLooted += chestsLooted;
                    totalItemsInserted += itemsInserted;
                    totalMobKills += mobKills;
                    
                    playerStats[player.playerName] = { chestsLooted, itemsInserted, mobKills };
                });
                
                document.getElementById('totalChestsLooted').textContent = totalChestsLooted;
                document.getElementById('totalItemsInserted').textContent = totalItemsInserted;
                document.getElementById('totalMobKills').textContent = totalMobKills;
                
                const createChart = (canvasId, label, data, color) => {
                    new Chart(document.getElementById(canvasId).getContext('2d'), {
                        type: 'bar',
                        data: { labels: Object.keys(playerStats), datasets: [{ label, data: Object.values(playerStats).map(p => p[label]), backgroundColor: color }] },
                        options: { responsive: true, scales: { y: { beginAtZero: true } } }
                    });
                };
                
                createChart('chestsChart', 'Chests Looted', Object.values(playerStats).map(p => p.chestsLooted), '#f39c12');
                createChart('itemsChart', 'Items Inserted (ME Network)', Object.values(playerStats).map(p => p.itemsInserted), '#3498db');
                createChart('mobsChart', 'Mob Kills', Object.values(playerStats).map(p => p.mobKills), '#e74c3c');
            } catch (error) {
                console.error('Error fetching stats:', error);
            }
        }

        fetchStats();
        setInterval(fetchStats, 900000);
    </script>
</body>
</html>
